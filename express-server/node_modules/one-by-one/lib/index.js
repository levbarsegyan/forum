"use strict";
var objDef = require("obj-def"),
    sliced = require("sliced");
module.exports = function oneByOne(arr, cb) {
    var self = this,
        result = [null],
        lastRes = [];
    var done = function done() {
        cb && cb.apply(self, result.concat(lastRes));
    };
    var doSeq = function doSeq(i) {
        if (i === arr.length) {
            return done();
        }
        var cFunc = arr[i];
        if (typeof cFunc !== "function") {
            return doSeq(++i);
        }
        cFunc.apply(self, [function () {
            var args = sliced(arguments);
            for (var ii = 1; ii < args.length; ++ii) {
                var cRes = objDef(result, ii, []);
                cRes[i] = args[ii];
            }
            if (args[0]) {
                result[0] = args[0];
                return done();
            }
            lastRes = sliced(args, 1);
            doSeq(++i);
        }].concat(lastRes));
    };
    doSeq(0);
};
