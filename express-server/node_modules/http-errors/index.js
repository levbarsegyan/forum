'use strict'
var deprecate = require('depd')('http-errors')
var setPrototypeOf = require('setprototypeof')
var statuses = require('statuses')
var inherits = require('inherits')
var toIdentifier = require('toidentifier')
module.exports = createError
module.exports.HttpError = createHttpErrorConstructor()
populateConstructorExports(module.exports, statuses.codes, module.exports.HttpError)
function codeClass (status) {
  return Number(String(status).charAt(0) + '00')
}
function createError () {
  var err
  var msg
  var status = 500
  var props = {}
  for (var i = 0; i < arguments.length; i++) {
    var arg = arguments[i]
    if (arg instanceof Error) {
      err = arg
      status = err.status || err.statusCode || status
      continue
    }
    switch (typeof arg) {
      case 'string':
        msg = arg
        break
      case 'number':
        status = arg
        if (i !== 0) {
          deprecate('non-first-argument status code; replace with createError(' + arg + ', ...)')
        }
        break
      case 'object':
        props = arg
        break
    }
  }
  if (typeof status === 'number' && (status < 400 || status >= 600)) {
    deprecate('non-error status code; use only 4xx or 5xx status codes')
  }
  if (typeof status !== 'number' ||
    (!statuses[status] && (status < 400 || status >= 600))) {
    status = 500
  }
  var HttpError = createError[status] || createError[codeClass(status)]
  if (!err) {
    err = HttpError
      ? new HttpError(msg)
      : new Error(msg || statuses[status])
    Error.captureStackTrace(err, createError)
  }
  if (!HttpError || !(err instanceof HttpError) || err.status !== status) {
    err.expose = status < 500
    err.status = err.statusCode = status
  }
  for (var key in props) {
    if (key !== 'status' && key !== 'statusCode') {
      err[key] = props[key]
    }
  }
  return err
}
function createHttpErrorConstructor () {
  function HttpError () {
    throw new TypeError('cannot construct abstract class')
  }
  inherits(HttpError, Error)
  return HttpError
}
function createClientErrorConstructor (HttpError, name, code) {
  var className = name.match(/Error$/) ? name : name + 'Error'
  function ClientError (message) {
    var msg = message != null ? message : statuses[code]
    var err = new Error(msg)
    Error.captureStackTrace(err, ClientError)
    setPrototypeOf(err, ClientError.prototype)
    Object.defineProperty(err, 'message', {
      enumerable: true,
      configurable: true,
      value: msg,
      writable: true
    })
    Object.defineProperty(err, 'name', {
      enumerable: false,
      configurable: true,
      value: className,
      writable: true
    })
    return err
  }
  inherits(ClientError, HttpError)
  nameFunc(ClientError, className)
  ClientError.prototype.status = code
  ClientError.prototype.statusCode = code
  ClientError.prototype.expose = true
  return ClientError
}
function createServerErrorConstructor (HttpError, name, code) {
  var className = name.match(/Error$/) ? name : name + 'Error'
  function ServerError (message) {
    var msg = message != null ? message : statuses[code]
    var err = new Error(msg)
    Error.captureStackTrace(err, ServerError)
    setPrototypeOf(err, ServerError.prototype)
    Object.defineProperty(err, 'message', {
      enumerable: true,
      configurable: true,
      value: msg,
      writable: true
    })
    Object.defineProperty(err, 'name', {
      enumerable: false,
      configurable: true,
      value: className,
      writable: true
    })
    return err
  }
  inherits(ServerError, HttpError)
  nameFunc(ServerError, className)
  ServerError.prototype.status = code
  ServerError.prototype.statusCode = code
  ServerError.prototype.expose = false
  return ServerError
}
function nameFunc (func, name) {
  var desc = Object.getOwnPropertyDescriptor(func, 'name')
  if (desc && desc.configurable) {
    desc.value = name
    Object.defineProperty(func, 'name', desc)
  }
}
function populateConstructorExports (exports, codes, HttpError) {
  codes.forEach(function forEachCode (code) {
    var CodeError
    var name = toIdentifier(statuses[code])
    switch (codeClass(code)) {
      case 400:
        CodeError = createClientErrorConstructor(HttpError, name, code)
        break
      case 500:
        CodeError = createServerErrorConstructor(HttpError, name, code)
        break
    }
    if (CodeError) {
      exports[code] = CodeError
      exports[name] = CodeError
    }
  })
  exports["I'mateapot"] = deprecate.function(exports.ImATeapot,
    '"I\'mateapot"; use "ImATeapot" instead')
}
