"use strict";
const gitUp = require("git-up");
function gitUrlParse(url) {
    if (typeof url !== "string") {
        throw new Error("The url must be a string.");
    }
    let urlInfo = gitUp(url)
      , sourceParts = urlInfo.resource.split(".")
      , splits = null
      ;
    urlInfo.toString = function (type) {
        return gitUrlParse.stringify(this, type);
    };
    urlInfo.source = sourceParts.length > 2
                   ? sourceParts.slice(-2).join(".")
                   : urlInfo.source = urlInfo.resource
                   ;
    urlInfo.name = urlInfo.pathname.substring(1).replace(/\.git$/, "");
    urlInfo.owner = urlInfo.user;
    urlInfo.organization = urlInfo.owner;
    switch (urlInfo.source) {
        case "cloudforge.com":
            urlInfo.owner = urlInfo.user;
            urlInfo.organization = sourceParts[0];
            break;
        default:
            splits = urlInfo.name.split("/");
            if (splits.length === 2) {
                urlInfo.owner = splits[0];
                urlInfo.name = splits[1];
            }
            break;
    }
    urlInfo.full_name = urlInfo.owner;
    if (urlInfo.name) {
        urlInfo.full_name && (urlInfo.full_name += "/");
        urlInfo.full_name += urlInfo.name;
    }
    return urlInfo;
}
gitUrlParse.stringify = function (obj, type) {
    type = type || obj.protocol;
    switch (type) {
        case "ssh":
            return `git@${obj.resource}:${obj.full_name}.git`;
        case "git+ssh":
            return `git+ssh:
        case "http":
        case "https":
            return `${type}:
        default:
            return obj.href;
    }
};
module.exports = gitUrlParse;
